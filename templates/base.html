<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mój Super Serwis{% endblock title %}</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Tutaj możesz dodać linki do CSS, np. z Bootstrapa -->
</head>
<body>
    <header>
        <!-- Tutaj możesz umieścić nawigację, logo itp. -->
        <h1>Sieć Społecznościowa</h1>
            <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm mb-4">
                <div class="container-fluid">
                    <a class="navbar-brand fw-bold" href="/">Sieć Społecznościowa</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="mainNavbar">
                        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link text-white" href="/">
                                    <i class="bi bi-house-door-fill"></i> Strona główna
                                </a>
                            </li>
                            {% if user.is_authenticated %}
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{% url 'profile' username=user.username %}">
                                        <i class="bi bi-person-circle"></i> Mój Profil
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{% url 'znajomi' %}">
                                        <i class="bi bi-people-fill"></i> Znajomi <span id="friend-requests-badge" class="badge bg-danger ms-1" style="display:none;font-size:0.7rem;"></span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{% url 'chat_list' %}">
                                        <i class="bi bi-chat-dots-fill"></i> Czat
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{% url 'logout' %}">
                                        <i class="bi bi-box-arrow-right"></i> Wyloguj
                                    </a>
                                </li>
                            {% else %}
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{% url 'login' %}">
                                        <i class="bi bi-box-arrow-in-right"></i> Zaloguj
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{% url 'register' %}">
                                        <i class="bi bi-person-plus"></i> Zarejestruj
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </nav>
            <hr>
    </header>

    <main>
                {% block content %}
                <!-- Treść z innych szablonów (np. Profile.html) pojawi się tutaj -->
                {% endblock content %}
                <!-- Django messages -->
                {% if messages %}
                <div class="container mt-3">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}
    </main>

    <footer>
        <hr>
            <p class="text-center text-muted small">&copy; {{ now|date:'Y' }} Sieć Społecznościowa</p>
    </footer>
    <!-- Bootstrap JS (for modal functionality) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
        (function(){
            // Poll pending friend requests count and update badge in navbar
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');
            function checkCount(){
                fetch('{% url "friend_requests_count" %}', { credentials: 'same-origin', headers: {'X-CSRFToken': csrftoken, 'X-Requested-With': 'XMLHttpRequest'} })
                    .then(r => r.json())
                    .then(data => {
                        const badge = document.getElementById('friend-requests-badge');
                        if (!badge) return;
                        const cnt = data && data.count ? data.count : 0;
                        if (cnt > 0) { badge.style.display = 'inline-block'; badge.textContent = cnt; }
                        else { badge.style.display = 'none'; }
                    }).catch(()=>{});
            }
            // run on load and every 30s
            try { checkCount(); setInterval(checkCount, 30000); } catch(e){}
        })();
        </script>
</body>
</html>